<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Empleado - Onix</title>
    <link rel="icon" href="../src/assets/img/logocafsena.png" type="image/x-icon">
    <link rel="stylesheet" href="../src/assets/css/empleado.css">
    <!-- Incluye Toastr CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
    <style>
        /* Ajustes para las notificaciones de Toastr */
        .toast {
            background-color: #333; /* Color de fondo oscuro */
            color: #fff; /* Texto blanco */
            border-radius: 5px; /* Bordes redondeados */
            padding: 10px 20px; /* Espaciado interno */
            font-size: 14px; /* Tamaño de fuente */
        }

        .toast-success {
            background-color: #9c6b2b; /* Verde para éxito */
        }

        .toast-error {
            background-color: #F44336; /* Rojo para error */
        }

        .toast-warning {
            background-color: #FFC107; /* Amarillo para advertencias */
        }

        .toast-info {
            background-color: #2196F3; /* Azul para información */
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <a href="#"><img src="../src/assets/img/logocafsenablanco.png" width="25%" height="100%" alt="Logo Onix"></a>
        </div>
        <nav>
            <ul>
                <li><a href="#" onclick="showProfile(); return false;">Perfil de empleado</a></li>
                <li><a href="#" onclick="showStockUpdate(); return false;">Ver Stock</a></li>
                <li><a href="#" onclick="showOrders(); return false;">Ver pedidos</a></li>
            </ul>
        </nav>
        <button class="logout-button" onclick="logout()">Cerrar Sesión</button>
    </header>

    <div class="container">
        <h1 class="section-title">Panel de empleado</h1>
        <div id="content">
            <!-- Contenido dinámico de cada sección -->
            <p>Bienvenido al panel de empleado. Selecciona una opción del menú para comenzar.</p>
        </div>
    </div>

    <footer>
        <p>&copy; 2024 Onix. Todos los derechos reservados.</p>
    </footer>

    <!-- Incluye Toastr JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script>
        // Mostrar el perfil del usuario
        function showProfile() {
    const user = JSON.parse(localStorage.getItem('loggedInUser'));

    if (user) {
        const profileContent = `
            <div class="profile">
                <h2>Perfil de Usuario</h2>
                <p><strong>Nombre:</strong> ${user.name}</p>
                <p><strong>Email:</strong> ${user.email}</p>
                <p><strong>Teléfono:</strong> ${user.phone}</p>
                <button onclick="editProfile()">Editar Perfil</button>
            </div>
        `;
        document.getElementById('content').innerHTML = profileContent;
    } else {
        toastr.warning('No hay información de perfil disponible.', 'Advertencia');
    }
}

        // Editar perfil del usuario
        function editProfile() {
            const user = JSON.parse(localStorage.getItem('loggedInUser'));

            if (user) {
                const editProfileContent = `
                    <div class="profile">
                        <h2>Editar Perfil</h2>
                        <form id="editProfileForm">
                            <label for="name">Nombre:</label>
                            <input type="text" id="name" name="name" value="${user.name}" required>
                            <label for="email">Email:</label>
                            <input type="email" id="email" name="email" value="${user.email}" required>
                            <label for="phone">Teléfono:</label>
                            <input type="tel" id="phone" name="phone" value="${user.phone}" required>
                            <button type="submit">Guardar Cambios</button>
                        </form>
                    </div>
                `;
                document.getElementById('content').innerHTML = editProfileContent;

                document.getElementById('editProfileForm').addEventListener('submit', function(event) {
                    event.preventDefault();
                    const updatedUser = {
                        ...user,
                        name: document.getElementById('name').value,
                        email: document.getElementById('email').value,
                        phone: document.getElementById('phone').value
                    };
                    localStorage.setItem('loggedInUser', JSON.stringify(updatedUser));
                    showProfile();
                    toastr.success('Perfil actualizado correctamente.', 'Éxito');
                });
            }
        }

        // Mostrar stock
        function showStockUpdate() {
    const stockContent = `
        <div id="productos" class="menu-section" style="display:block;">
            <h2>Productos</h2>
            <div class="search-bar" style="text-align:center;">
                <input type="text" id="search-productos" placeholder="Buscar productos..." 
                onkeyup="searchTable('productos-table', 'search-productos')" style="padding: 10px; width: 60%; border: 1px solid #ccc; border-radius: 5px; font-size: 16px;">
            </div>
            <br><br>
            <table id="productos-table" style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background-color: #f2f2f2; color: #333;">
                        <th style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd;">Nombre</th>
                        <th style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd;">Precio</th>
                        <th style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd;">Descripción</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    `;
    document.getElementById('content').innerHTML = stockContent;

    fetch('http://demo4284921.mockable.io/api/v1/Productos/getProductos')
        .then(response => response.json())
        .then(data => llenarTablaProducto(data))
        .catch(error => console.error('Error al obtener los datos:', error));
}

function llenarTablaProducto(data) {
    const tabla = document.getElementById('productos-table').getElementsByTagName('tbody')[0];
    tabla.innerHTML = ''; 
    data.forEach(producto => {
        const fila = tabla.insertRow();
        fila.style.borderBottom = '1px solid #ddd';
        fila.style.textAlign = 'center';
        
        const nombreCell = fila.insertCell(0);
        const precioCell = fila.insertCell(1);
        const descripcionCell = fila.insertCell(2);
        
        nombreCell.textContent = producto.nombre;
        precioCell.textContent = `$${producto.precio.toFixed(2)}`;
        descripcionCell.textContent = producto.descripcion;
        
        [nombreCell, precioCell, descripcionCell].forEach(cell => {
            cell.style.padding = '10px';
        });
    });
}


        // Función de búsqueda en stock
        function searchTable(tableId, searchInputId) {
            const searchInput = document.getElementById(searchInputId).value.toLowerCase();
            const rows = document.querySelectorAll(`#${tableId} tbody tr`);

            rows.forEach(row => {
                const cells = row.getElementsByTagName('td');
                const matches = Array.from(cells).some(cell => cell.textContent.toLowerCase().includes(searchInput));
                row.style.display = matches ? '' : 'none';
            });
        }

        // Mostrar pedidos
        function showOrders() {
            let orders = JSON.parse(localStorage.getItem('orders')) || [];
            
            let orderContent = `
                <h2>Pedidos de Clientes</h2>
                <ul class="order-list">
            `;

            orders.forEach((order) => {
                orderContent += `
                    <li>
                        <h3>Pedido #${order.id}</h3>
                        <p><strong>Estado:</strong>
                            <select onchange="updateOrderStatus(${order.id}, this.value)">
                                <option value="En preparación" ${order.status === 'En preparación' ? 'selected' : ''}>En preparación</option>
                                <option value="En camino" ${order.status === 'En camino' ? 'selected' : ''}>En camino</option>
                                <option value="Entregado" ${order.status === 'Entregado' ? 'selected' : ''}>Entregado</option>
                            </select>
                        </p>
                        <ul>
                            ${order.items.map(item => `<li>${item.product} - $${item.price}</li>`).join('')}
                        </ul>
                    </li>
                `;
            });

            orderContent += `</ul>`;

            document.getElementById('content').innerHTML = orderContent;
        }

        // Actualizar el estado de un pedido
        function updateOrderStatus(orderId, newStatus) {
            let orders = JSON.parse(localStorage.getItem('orders')) || [];
            let orderHistory = JSON.parse(localStorage.getItem('orderHistory')) || [];

            orders = orders.map(order => {
                if (order.id === orderId) {
                    order.status = newStatus;

                    if (newStatus === "Entregado") {
                        orderHistory.push(order);
                    }
                }
                return order;
            });

            orders = orders.filter(order => order.status !== "Entregado");

            localStorage.setItem('orders', JSON.stringify(orders));
            localStorage.setItem('orderHistory', JSON.stringify(orderHistory));

            toastr.success('Estado de pedido actualizado.', 'Éxito');
            showOrders();
        }

        // Cerrar sesión
        function logout() {
            localStorage.removeItem('loggedInUser');
            window.location.href = 'login.html';
        }

        // Open modal to add product
        function openAddProductModal() {
            const modalContent = `
                <div class="modal">
                    <h2>Agregar Producto</h2>
                    <form id="addProductForm">
                        <label for="nombre">Nombre:</label>
                        <input type="text" id="nombre" required>
                        <label for="precio">Precio:</label>
                        <input type="number" id="precio" required>
                        <label for="descripcion">Descripción:</label>
                        <textarea id="descripcion" required></textarea>
                        <button type="submit">Agregar</button>
                        <button type="button" onclick="closeModal()">Cancelar</button>
                    </form>
                </div>
            `;
            document.getElementById('content').innerHTML = modalContent;

            document.getElementById('addProductForm').addEventListener('submit', function(event) {
                event.preventDefault();
                const newProduct = {
                    nombre: document.getElementById('nombre').value,
                    precio: parseFloat(document.getElementById('precio').value),
                    descripcion: document.getElementById('descripcion').value
                };
                addProduct(newProduct);
                closeModal();
            });
        }

        // Add new product
        function addProduct(product) {
            fetch('http://demo4284921.mockable.io/api/v1/Productos/addProducto', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(product)
            })
            .then(response => response.json())
            .then(data => {
                toastr.success('Producto agregado correctamente.', 'Éxito');
                showStockUpdate();
            })
            .catch(error => {
                console.error('Error al agregar el producto:', error);
                toastr.error('Error al agregar el producto.', 'Error');
            });
        }

        // Close modal
        function closeModal() {
            showStockUpdate(); // Vuelve a mostrar la sección de stock
        }
    </script>
</body>
</html>