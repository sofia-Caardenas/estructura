<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Empleado - Onix</title>
    <link rel="icon" href="../src/assets/img/logocafsena.png" type="image/x-icon">
    <link rel="stylesheet" href="../src/assets/css/empleado.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
 
</head>
<body>
    <header>
        <div class="logo">
            <a href="#"><img src="../src/assets/img/logocafsenablanco.png" width="25%" height="100%" alt="Logo Onix"></a>
        </div>
        <nav>
            <ul>
                <li><a href="#" onclick="showProfile(); return false;">Perfil de empleado</a></li>
                <li><a href="#" onclick="showStockUpdate(); return false;">Ver Stock</a></li>
                <li><a href="#" onclick="showOrders(); return false;">Ver pedidos</a></li>
            </ul>
        </nav>
        <button class="logout-button" onclick="logout()">Cerrar Sesión</button>
    </header>

    <div class="container">
        <h1 class="section-title">Panel de empleado</h1>
        <div id="content">
            <p>Bienvenido al panel de empleado. Selecciona una opción del menú para comenzar.</p>
        </div>
    </div>

    <footer>
        <p>&copy; 2024 Onix. Todos los derechos reservados.</p>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script>
        // Mostrar el perfil del usuario
        async function showProfile() {
            fetch('http://demo4284921.mockable.io/api/v1/Usuarios/getUsuarios')
            .then(response => response.json())
            .then(data => llenarTabla(data))
            .catch(error => console.error('Error al obtener los datos de usuarios:', error));
        }
        
        // Función para llenar la tabla con los datos del empleado
        function llenarTabla(data) {
            // Suponiendo que 'data' es un objeto con la información del empleado
            const userProfileContent = `
                <div class="profile">
                    <h2>Perfil de Empleado</h2>
                    <p><strong>Nombre:</strong> ${data.nombre}</p>
                    <p><strong>Email:</strong> ${data.email}</p>
                    <p><strong>Teléfono:</strong> ${data.phone}</p>
                    <button onclick="editProfile()">Editar Perfil</button>
                </div>
            `;
            document.getElementById('content').innerHTML = userProfileContent;
        }
     

        // Editar perfil del usuario
        function editProfile() {
            const user = JSON.parse(localStorage.getItem('loggedInUser'));
            if (user) {
                const editProfileContent = `
                    <div class="profile">
                        <h2>Editar Perfil</h2>
                        <form id="editProfileForm">
                            <label for="name">Nombre:</label>
                            <input type="text" id="name" name="name" value="${user.name}" required>
                            <label for="email">Email:</label>
                            <input type="email" id="email" name="email" value="${user.email}" required>
                            <label for="phone">Teléfono:</label>
                            <input type="tel" id="phone" name="phone" value="${user.phone}" required>
                            <button type="submit">Guardar Cambios</button>
                        </form>
                    </div>
                `;  
                document.getElementById('content').innerHTML = editProfileContent;

                document.getElementById('editProfileForm').addEventListener('submit', function(event) {
                    event.preventDefault();
                    const updatedUser = {
                        ...user,
                        name: document.getElementById('name').value,
                        email: document.getElementById('email').value,
                        phone: document.getElementById('phone').value
                    };
                    localStorage.setItem('loggedInUser', JSON.stringify(updatedUser));
                    showProfile();
                    toastr.success('Perfil actualizado correctamente.', 'Éxito');
                });
            }
        }

        // Mostrar stock
// Mostrar stock
function showStockUpdate() {
            const stockContent = `
                <div id="productos" class="menu-section" style="display:block;">
                    <h2>Productos</h2>
                    <div class="search-bar">
                        <input type="text" id="search-productos" placeholder="Buscar productos..." onkeyup="searchTable('productos-container', 'search-productos')">
                    </div>
                    <br>
                    <div class="productos-container" id="productos-container">
                        <div class="product-card">
                            <h3>Café</h3>
                            <p>Precio: $.50</p>
                            <p>Stock: 100</p>
                        </div>
                        <div class="product-card">
                            <h3>Té</h3>
                            <p>Precio: $1.50</p>
                            <p>Stock: 80</p>
                        </div>
                        <div class="product-card">
                            <h3>Pastel</h3>
                            <p>Precio: $3.00</p>
                            <p>Stock: 50</p>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('content').innerHTML = stockContent;
        }

        // Función de búsqueda en la tabla
        function searchTable(tableId, inputId) {
            const input = document.getElementById(inputId);
            const filter = input.value.toLowerCase();
            const table = document.getElementById(tableId);
            const tr = table.getElementsByTagName('tr');

            for (let i = 1; i < tr.length; i++) {
                const td = tr[i].getElementsByTagName('td');
                let txtValue = '';
                for (let j = 0; j < td.length; j++) {
                    if (td[j]) {
                        txtValue += td[j].textContent || td[j].innerText;
                    }
                }
                tr[i].style.display = txtValue.toLowerCase().indexOf(filter) > -1 ? '' : 'none';
            }
        }

// Mostrar pedidos
// Mostrar pedidos
function showOrders() {
    const ordersContent = `
        <div class="orders">
            <h2 class="orders-title">Lista de Pedidos</h2>
            <div class="order-cards">
                <div class="order-card">
                    <h3>Pedido #1</h3>
                    <p><strong>Producto:</strong> Café</p>
                    <p><strong>Estado:</strong> En preparación</p>
                    <button onclick="updateOrderStatus(1, 'Completado')">Actualizar a Completado</button>
                </div>
                <div class="order-card">
                    <h3>Pedido #2</h3>
                    <p><strong>Producto:</strong> Pastel</p>
                    <p><strong>Estado:</strong> En preparación</p>
                    <button onclick="updateOrderStatus(2, 'Completado')">Actualizar a Completado</button>
                </div>
                <div class="order-card">
                    <h3>Pedido #3</h3>
                    <p><strong>Producto:</strong> Té</p>
                    <p><strong>Estado:</strong> En preparación</p>
                    <button onclick="updateOrderStatus(3, 'Completado')">Actualizar a Completado</button>
                </div>
            </div>
        </div>
    `;
    document.getElementById('content').innerHTML = ordersContent;
}
// Función para actualizar el estado del pedido
async function updateOrderStatus(orderId) {
    // Obtener los detalles del pedido desde la interfaz
    const orderCard = document.getElementById(`order${orderId}`);
    const producto = orderCard.querySelector('h3').textContent; // Nombre del producto
    const cantidad = orderCard.querySelector('p:nth-child(3)').textContent.split(': ')[1]; // Cantidad
    const precio = orderCard.querySelector('p:nth-child(4)').textContent.split(': ')[1].replace('$', ''); // Precio
    const nuevoEstado = document.getElementById(`estado${orderId}`).value; // Estado seleccionado

    // Crear el cuerpo del pedido dinámicamente
    const pedidoDetalle = [
        {
            "cantidad": cantidad,
            "precio": precio,
            "subtotal": (precio * cantidad).toFixed(2),
            "pedidos": {
                "fechaPedido": new Date().toISOString().split('T')[0], // Fecha actual
                "estado": nuevoEstado, // El nuevo estado seleccionado
                "total": (precio * cantidad).toFixed(2),
                "usuarios": {
                    "id": 6 // Esto debería provenir del usuario logueado
                }
            },
            "productos": {
                "id": orderId // Id del producto (basado en el pedido)
            }
        }
    ];

    try {
        const response = await fetch('http://demo4284921.mockable.io/api/v1/Pedidos/guardarPedidoDetalle', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(pedidoDetalle)
        });

        if (response.ok) {
            toastr.success('El estado del pedido se actualizó correctamente.', 'Éxito');
            showOrders(); // Recargar la lista de pedidos
        } else {
            toastr.error('Hubo un error al actualizar el pedido.', 'Error');
        }
    } catch (error) {
        console.error('Error al hacer la solicitud:', error);
        toastr.error('Hubo un error en la solicitud.', 'Error');
    }
}



        // Cerrar sesión
        function logout() {
            localStorage.removeItem('loggedInUser');
            window.location.href = 'login.html';
        }
    </script>
</body>
</html>
